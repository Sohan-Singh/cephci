#FOLIO Primary Setup
# run pre-requisites

tests:
   - test:
       abort-on-fail: true
       desc: Install software pre-requisites for cluster deployment.
       module: install_prereq.py
       name: setup pre-requisites

   - test: # perform bootstrap
       abort-on-fail: true
       clusters:
         ceph-pri:
           config:
             verify_cluster_health: true
             steps:
               - config:
                   command: bootstrap
                   service: cephadm
                   args:
                     registry-url: registry.redhat.io
                     mon-ip: folio08
                     allow-fqdn-hostname: true
                     orphan-initial-daemons: true
                     initial-dashboard-password: admin@123
                     dashboard-password-noupdate: true

       desc: Bootstrap clusters using cephadm.
       polarion-id: CEPH-83573386
       destroy-cluster: false
       module: test_cephadm.py
       name: Bootstrap clusters

   - test: #enable ptrace and set log to file
       abort-on-fail: true
       clusters:
         ceph-pri:
           config:
             cephadm: true
             commands:
               - "ceph config set mgr mgr/cephadm/allow_ptrace true"
               - "ceph config set global log_to_file true"
               - "ceph config set global mon_cluster_log_to_file true"
       desc: setup debugging(ptrace) for containers
       module: exec.py
       name: setup debugging for containers
       polarion-id: CEPH-10362

   - test: #deploy more mons and mgrs
       abort-on-fail: true
       clusters:
         ceph-pri:
           config:
             verify_cluster_health: true
             steps:
               - config:
                   command: add_hosts
                   service: host
                   args:
                     attach_ip_address: true
                     labels: apply-all-labels
               - config:
                   command: apply
                   service: mgr
                   args:
                     placement:
                       label: mgr
               - config:
                   command: apply
                   service: mon
                   args:
                     placement:
                       label: mon
       desc: RHCS deploy more mons and mgrs.
       polarion-id: CEPH-83575222
       destroy-cluster: false
       module: test_cephadm.py
       name: deploy more mons and mgrs

   - test: # deploy osds
       abort-on-fail: true
       clusters:
         ceph-pri:
           config:
             verify_cluster_health: true
             steps:
               - config:
                   command: apply
                   service: osd
                   args:
                     all-available-devices: true
       desc: RHCS deploy osds.
       polarion-id: CEPH-83575222
       destroy-cluster: false
       module: test_cephadm.py


   - test: # deploy io rgws
       abort-on-fail: true
       clusters:
         ceph-pri:
           config:
             verify_cluster_health: true
             steps:
               - config:
                   command: apply
                   service: rgw
                   pos_args:
                     - india.io
                   args:
                     port: 80
                     placement:
                       nodes:
                         - folio16
                         - folio17
                         - folio18
       desc: RHCS IO rgws deploy using cephadm.
       polarion-id: CEPH-83575222
       destroy-cluster: false
       module: test_cephadm.py
       name: IO rgws deploy using cephadm
   - test:
       abort-on-fail: true
       clusters:
         ceph-pri:
           config:
             verify_cluster_health: true
             steps:
               - config:
                   command: apply_spec
                   service: orch
                   validate-spec-services: true
                   specs:
                     - service_type: prometheus
                       placement:
                         count: 1
                         nodes:
                           - folio08
                     - service_type: grafana
                       placement:
                         nodes:
                           - folio08
                     - service_type: alertmanager
                       placement:
                         count: 1
                     - service_type: node-exporter
                       placement:
                         host_pattern: "*"
                     - service_type: crash
                       placement:
                         host_pattern: "*"
       name: Monitoring Services deployment
       desc: Add monitoring services using spec file.
       module: test_cephadm.py
       polarion-id: CEPH-83574727

   - test:
       abort-on-fail: true
       config:
         command: add
         id: client.1
         node: folio18
         install_packages:
           - ceph-common
         copy_admin_keyring: true
         git_clone: true
         git_node_role: rgw
       desc: Configure the RGW client system
       polarion-id: CEPH-83573758
       destroy-cluster: false
       module: test_client.py
       name: configure client